(self["webpackChunkapp"]=self["webpackChunkapp"]||[]).push([[280],{26327:function(e,t,i){"use strict";i.d(t,{Z:function(){return g}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"_sectionsList"},[i("SectionsSummary",{attrs:{sections:e.sections,opened_section:e.opened_section,can_edit:e.can_edit},on:{createSection:e.createSection,openSection:e.openSection,updateOrder:e.updateOrder}}),i("transition",{attrs:{name:"pagechange",mode:"out-in"}},[e.opened_section?i("div",{key:e.opened_section.$path},[i("SingleSection",{attrs:{publication:e.publication,section:e.opened_section,can_edit:e.can_edit},on:{remove:function(t){return e.removeSection(e.opened_section.$path)},close:e.closeSection}}),i("div",{staticClass:"_navBtns"},[i("div",{staticClass:"_navBtns--content"},[e.prev_section?i("span",{staticClass:"_navbtn",on:{click:e.prevSection}},[i("sl-icon",{attrs:{name:"arrow-left-circle"}}),e._v(" "+e._s(e.prev_section.section_title)+" ")],1):e._e(),e.next_section?i("span",{staticClass:"_navbtn",on:{click:e.nextSection}},[e._v(" "+e._s(e.next_section.section_title)+" "),i("sl-icon",{attrs:{name:"arrow-right-circle"}})],1):e._e()])])],1):e._e()])],1)},a=[],s=(i(57658),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"_sectionsSummary"},[i("ProjectCard",{attrs:{header:e.$t("summary"),icon:"file-earmark-arrow-down",has_items:e.sections.length>0&&e.sections.length}},[i("SlickList",{staticClass:"_list",attrs:{axis:"y",value:e.sections,useDragHandle:!0},on:{input:function(t){return e.$emit("updateOrder",t)}}},e._l(e.sections,(function(t,n){return i("SlickItem",{key:t.$path,staticClass:"_summaryItem",class:{"is--active":e.isActive(t.$path)},attrs:{index:n}},[e.can_edit?i("span",{directives:[{name:"handle",rawName:"v-handle"}],staticClass:"_dragHandle"},[i("sl-icon",{attrs:{name:"grip-vertical",label:"DÃ©placer"}})],1):e._e(),i("span",{staticClass:"_clickZone",on:{click:function(i){return e.$emit("openSection",t.$path)}}},[i("h4",{staticClass:"_title"},[t.section_title?i("span",[e._v(" "+e._s(t.section_title)+" ")]):i("span",{domProps:{innerHTML:e._s("<i>"+e.$t("untitled")+"</i>")}})])])])})),1),e.can_edit?[i("hr"),i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(t){return e.$emit("createSection")}}},[e._v(" "+e._s(e.$t("create_section"))+" ")])]:e._e()],2)],1)}),o=[],c=i(8771),r=i(55656),l={props:{sections:Array,opened_section:[Boolean,Object],can_edit:Boolean},components:{ProjectCard:c.Z,SlickItem:r.SlickItem,SlickList:r.SlickList},directives:{handle:r.HandleDirective},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{isActive(e){return this.opened_section&&e===this.opened_section.$path}}},d=l,u=(i(68037),i(21148),i(1001)),p=(0,u.Z)(d,s,o,!1,null,"17c99207",null),_=p.exports,m=i(51838),h={props:{publication:Object,section_opened_meta:String,can_edit:Boolean},components:{SectionsSummary:_,SingleSection:m.Z},data(){return{}},created(){},mounted(){this.publication.sections_list&&!this.section_opened_meta&&this.$emit("toggleSection",this.publication.sections_list[0].meta_filename)},beforeDestroy(){},watch:{},computed:{sections_list(){return this.publication.sections_list||[]},sections(){const e=this.publication.$files?this.publication.$files.filter((e=>Object.prototype.hasOwnProperty.call(e,"section_type"))):[];return 0!==e.length&&this.publication.sections_list?this.publication.sections_list.map((({meta_filename:t})=>e.find((e=>e.$path.endsWith("/"+t))))):[]},opened_section(){var e;return null===(e=this.publication.$files)||void 0===e?void 0:e.find((e=>e.$path.endsWith("/"+this.section_opened_meta)))},opened_section_index(){return this.sections.findIndex((e=>e.$path===this.opened_section.$path))},next_section(){return this.opened_section_index<this.sections.length-1&&this.sections[this.opened_section_index+1]},prev_section(){return this.opened_section_index>0&&this.sections[this.opened_section_index-1]}},methods:{async createSection(){const e=await this.$api.uploadFile({path:this.publication.$path,additional_meta:{section_type:"-",requested_slug:"section"}}).catch((e=>{throw this.$alertify.delay(4e3).error(e),e}));let t=this.sections_list.slice();t.push({meta_filename:e}),await this.updatePubliMeta({sections_list:t}),this.$emit("toggleSection",e)},async removeSection(e){const t=this.getFilename(e);let i=this.sections_list.slice();i=i.filter((e=>e.meta_filename!==t)),this.updatePubliMeta({sections_list:i}),await this.$api.deleteItem({path:e})},async updatePubliMeta(e){return await this.$api.updateMeta({path:this.publication.$path,new_meta:e})},openSection(e){const t=this.getFilename(e);this.$emit("toggleSection",t)},closeSection(){this.$emit("toggleSection",!1)},updateOrder(e){const t=e.map((e=>({meta_filename:this.getFilename(e.$path)})));if(JSON.stringify(t)===JSON.stringify(this.sections_list))return"no_update_necessary";this.updatePubliMeta({sections_list:t})},nextSection(){this.openSection(this.next_section.$path)},prevSection(){this.openSection(this.prev_section.$path)}}},f=h,v=(i(70998),(0,u.Z)(f,n,a,!1,null,"56e82de1",null)),g=v.exports},51838:function(e,t,i){"use strict";i.d(t,{Z:function(){return v}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"_singleSection"},[i("div",{staticClass:"_storyContainer"},[i("div",{staticClass:"_storyContent",style:e.story_styles},[i("div",{staticClass:"_topbar"},[i("SectionTitle",{attrs:{section:e.section,can_edit:e.can_edit}}),e.can_edit?i("div",{staticClass:"u-sameRow"},[i("RemoveMenu",{attrs:{remove_text:e.$t("remove")},on:{remove:function(t){return e.$emit("remove")}}}),i("div",[i("button",{staticClass:"u-buttonLink",attrs:{type:"button"},on:{click:function(t){return e.$emit("close")}}},[i("sl-icon",{attrs:{name:"x"}}),e._v(" "+e._s(e.$t("close"))+" ")],1)])],1):e._e()],1),i("transition-group",{attrs:{tag:"div",name:"StoryModules",appear:"",duration:700}},[e._l(e.modules_list,(function(t,n){return[i("PublicationModule",{key:t,staticClass:"_mediaPublication",attrs:{publimodule:e.findModuleFromMetaFilename(t),module_position:1===e.modules_list.length?"alone":0===n?"first":n===e.modules_list.length-1?"last":"inbetween",can_edit:e.can_edit},on:{resize:function(i){return e.resize({meta_filename:t,new_size:i})},moveUp:function(i){return e.moveTo({meta_filename:t,dir:-1})},moveDown:function(i){return e.moveTo({meta_filename:t,dir:1})},duplicate:function(i){return e.duplicatePublicationMedia({source_meta_filename:t,copy_meta_filename:i})},remove:function(i){return e.removeModuleFromList(t)}}}),i("div",{key:"mc_"+n,staticClass:"_spacer"},[e.can_edit?i("ModuleCreator",{attrs:{publication_path:e.publication.$path,meta_filenames_already_present:e.meta_filenames_already_present},on:{addModule:function(t){var i=t.meta_filename;return e.insertModuleMetaFilenameToList({meta_filename:i,index:n+1})}}}):e._e()],1)]}))],2),!e.can_edit||e.modules_list&&0!==e.modules_list.length?e._e():i("ModuleCreator",{attrs:{publication_path:e.publication.$path},on:{addModule:e.appendModuleMetaFilenameToList}})],1)])])},a=[],s=(i(85827),i(57658),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"_sectionTitle"},[i("TitleField",{attrs:{field_name:"section_title",label:e.can_edit?e.$t("section_title"):"",content:e.section.section_title,path:e.section.$path,maxlength:120,tag:"h3",can_edit:e.can_edit}}),i("TitleField",{attrs:{field_name:"section_description",label:e.can_edit?e.$t("description"):"",content:e.section.section_description,path:e.section.$path,maxlength:1280,input_type:"markdown",can_edit:e.can_edit}})],1)}),o=[],c={props:{section:Object,can_edit:Boolean},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}},r=c,l=i(1001),d=(0,l.Z)(r,s,o,!1,null,"724f4aa2",null),u=d.exports,p=i(91317),_=i(83171),m={props:{publication:Object,section:Object,can_edit:Boolean},components:{SectionTitle:u,ModuleCreator:p.Z,PublicationModule:_.Z},data(){return{medias:[]}},created(){},async mounted(){},beforeDestroy(){},watch:{},computed:{story_styles(){return""},modules_list(){if(this.section.modules_list&&Array.isArray(this.section.modules_list)){const e=this.section.modules_list.reduce(((e,t)=>{const i=this.findModuleFromMetaFilename(t);return i&&e.push(t),e}),[]);return e}return[]},meta_filenames_already_present(){return this.modules_list.reduce(((e,t)=>{const i=this.findModuleFromMetaFilename(t);return i.source_medias&&i.source_medias.map((t=>{t.meta_filename_in_project&&e.push(t.meta_filename_in_project)})),e}),[])}},methods:{async appendModuleMetaFilenameToList({meta_filename:e}){const t=this.modules_list.slice();t.push(e),await this.updateMeta({modules_list:t}),this.toggleNewModuleEdit({meta_filename:e})},async insertModuleMetaFilenameToList({meta_filename:e,index:t}){const i=this.modules_list.slice();i.splice(t,0,e),await this.updateMeta({modules_list:i}),this.toggleNewModuleEdit({meta_filename:e})},async updateMeta(e){this.fetch_status="pending",this.fetch_error=null;try{this.response=await this.$api.updateMeta({path:this.section.$path,new_meta:e}),this.fetch_status="success"}catch(t){this.fetch_status="error",this.fetch_error=t.response.data}},findModuleFromMetaFilename(e){return this.publication.$files?this.publication.$files.find((t=>{const i=t.$path.substring(t.$path.lastIndexOf("/")+1);return i===e})):[]},async moveTo({meta_filename:e,dir:t}){let i=this.modules_list.slice();const n=i.findIndex((t=>t===e));return!(n+t<0)&&(!(n+t>i.length-1)&&(i.move(n,n+t),void(this.response=await this.updateMeta({modules_list:i}))))},async duplicatePublicationMedia({source_meta_filename:e,copy_meta_filename:t}){let i=this.modules_list.slice();const n=i.findIndex((t=>t===e));i.splice(n+1,0,t),this.response=await this.updateMeta({modules_list:i})},async removeModuleFromList(e){let t=this.modules_list.slice();t=t.filter((t=>t!==e)),this.response=await this.updateMeta({modules_list:t})},toggleNewModuleEdit({meta_filename:e}){setTimeout((()=>{console.log(`emit module.enable_edit.${e}`),this.$eventHub.$emit(`module.enable_edit.${e}`)}),50)}}},h=m,f=(i(91640),(0,l.Z)(h,n,a,!1,null,"5ef25609",null)),v=f.exports},12280:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return f}});var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",["settings"===e.current_view&&e.can_edit?i("StorySettings",{attrs:{publication:e.publication}}):i("SectionsList",{attrs:{publication:e.publication,section_opened_meta:e.section_opened_meta,can_edit:e.can_edit},on:{toggleSection:function(t){return e.$emit("toggleSection",t)},closePublication:function(t){return e.$emit("closePublication")}}})],1)},a=[],s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},o=[],c={props:{},components:{},data(){return{}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}},r=c,l=i(1001),d=(0,l.Z)(r,s,o,!1,null,"618e1b8f",null),u=d.exports,p=i(26327),_={props:{publication:Object,section_opened_meta:String,can_edit:Boolean},components:{StorySettings:u,SectionsList:p.Z},data(){return{current_view:"section"}},created(){},mounted(){},beforeDestroy(){},watch:{},computed:{},methods:{}},m=_,h=(i(77491),(0,l.Z)(m,n,a,!1,null,"7f5a0d1d",null)),f=h.exports},65618:function(e,t,i){"use strict";i.r(t);var n=i(8081),a=i.n(n),s=i(23645),o=i.n(s),c=o()(a());c.push([e.id,"._sectionsList[data-v-56e82de1]{position:relative}._navBtns[data-v-56e82de1]{justify-content:center;text-decoration:underline;margin-bottom:calc(var(--spacing)*4)}._navBtns[data-v-56e82de1],._navBtns--content[data-v-56e82de1]{display:flex;align-items:center}._navBtns--content[data-v-56e82de1]{gap:calc(var(--spacing)/1)}._navbtn[data-v-56e82de1]{cursor:pointer;display:flex;align-items:center;gap:calc(var(--spacing)/4);background:#fff;padding:calc(var(--spacing)/4) calc(var(--spacing)/2);border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,.2)}._navbtn[data-v-56e82de1]:focus-visible,._navbtn[data-v-56e82de1]:hover{background:var(--c-gris)}",""]),t["default"]=c},10105:function(e,t,i){"use strict";i.r(t);var n=i(8081),a=i.n(n),s=i(23645),o=i.n(s),c=o()(a());c.push([e.id,"._sectionsSummary[data-v-17c99207]{max-width:60ch;width:100%;margin:calc(var(--spacing)/1) auto}._dragHandle[data-v-17c99207]{display:flex;cursor:grab;padding:calc(var(--spacing)/4);background:var(--c-gris);color:#000;border-radius:2px}._dragHandle[data-v-17c99207]:focus-visible,._dragHandle[data-v-17c99207]:hover{background:transparent}._list[data-v-17c99207]{color:#000}",""]),t["default"]=c},63905:function(e,t,i){"use strict";i.r(t);var n=i(8081),a=i.n(n),s=i(23645),o=i.n(s),c=o()(a());c.push([e.id,"._summaryItem{z-index:10000;display:flex;flex-flow:row wrap;align-items:center;padding:calc(var(--spacing)/4);gap:calc(var(--spacing)/4)}._summaryItem ._clickZone{text-decoration:underline;cursor:pointer}._summaryItem ._clickZone:focus-visible,._summaryItem ._clickZone:hover{background:var(--c-gris_clair)}._summaryItem ._title{padding:calc(var(--spacing)/8) calc(var(--spacing)/4);border-radius:2px}._summaryItem.is--active ._title{background:var(--c-orange)}",""]),t["default"]=c},52672:function(e,t,i){"use strict";i.r(t);var n=i(8081),a=i.n(n),s=i(23645),o=i.n(s),c=o()(a());c.push([e.id,"._singleSection[data-v-5ef25609]{position:relative;display:flex;justify-content:center;flex-flow:column nowrap;align-items:center;margin:0 auto calc(var(--spacing)*4)}._storyContainer[data-v-5ef25609]{width:100%}._storyContent[data-v-5ef25609]{width:100%;background:#fff;max-width:86ch;padding:calc(var(--spacing)*1) 0;margin:0 auto;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,.2);transition:all .4s cubic-bezier(.19,1,.22,1)}._mediaPublication[data-v-5ef25609]{position:relative;margin-bottom:0}._mediaPublication[data-v-5ef25609]  ._content{min-height:72px}._mediaPublication[data-v-5ef25609]  ._floatingEditBtn[data-action=disable]{display:none}._spacer[data-v-5ef25609]{min-height:3rem;display:flex;align-items:center;justify-content:center;padding:calc(var(--spacing)/4) 0}._topbar[data-v-5ef25609]{display:flex;flex-flow:row wrap;align-items:flex-start;justify-content:space-between;margin:0 calc(var(--spacing)/1) calc(var(--spacing)*1.5);padding-bottom:calc(var(--spacing)/1);border-bottom:2px solid var(--c-gris)}",""]),t["default"]=c},82616:function(e,t,i){"use strict";i.r(t);var n=i(8081),a=i.n(n),s=i(23645),o=i.n(s),c=o()(a());c.push([e.id,"._switch[data-v-7f5a0d1d]{margin:calc(var(--spacing)*1) 0}",""]),t["default"]=c},70998:function(e,t,i){var n=i(65618);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var a=i(31982).Z;a("54418392",n,!0,{sourceMap:!1,shadowMode:!1})},68037:function(e,t,i){var n=i(10105);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var a=i(31982).Z;a("56add110",n,!0,{sourceMap:!1,shadowMode:!1})},21148:function(e,t,i){var n=i(63905);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var a=i(31982).Z;a("011eeee4",n,!0,{sourceMap:!1,shadowMode:!1})},91640:function(e,t,i){var n=i(52672);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var a=i(31982).Z;a("7b442378",n,!0,{sourceMap:!1,shadowMode:!1})},77491:function(e,t,i){var n=i(82616);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var a=i(31982).Z;a("ec60a604",n,!0,{sourceMap:!1,shadowMode:!1})}}]);
//# sourceMappingURL=280.js.map